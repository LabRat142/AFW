<!DOCTYPE html>
<html>
<head>
    <title>Watchlist</title>
	<link rel="icon" type="image/png" href="favicon.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
	<link href="./css/index.css" rel="stylesheet" />
    <script src="js/jikan.js" type="text/javascript"></script>
    <script src="js/common.js" type="text/javascript"></script>
    <script src="js/init.js" type="text/javascript"></script>
	<script src="js/index.js" type="text/javascript"></script>
	<script src="js/search.js" type="text/javascript"></script>
	<script src="js/relations.js" type="text/javascript"></script>
	<script src="js/list.js" type="text/javascript"></script>
	<script src="js/details.js" type="text/javascript"></script>
	<script src="js/recalc.js" type="text/javascript"></script>
	<script src="js/malport.js" type="text/javascript"></script>
</head>
<body>
	<!-- Home Page -->
	<div id="index" class="page" style="display:block;">
		<div class="container py-5">
			<!-- Title & Info -->
			<div class="text-center mb-4">
				<h1 class="fw-bold text-primary">ğŸ¬ Anime Franchises Watchlist</h1>
				<p class="text-muted">Track your favorites, explore franchises, and build your perfect list.</p>
			</div>

			<div class="row justify-content-start">
				<!-- GOTO Anime Search -->
				<div class="col-md-4 offset-md-2 mb-3">
					<div class="card shadow-sm h-100">
						<div class="card-body text-center">
							<h5 class="card-title">ğŸ” Search Anime</h5>
							<p class="card-text">Find titles, explore related series, and add them to your franchise.</p>
							<button class="btn btn-primary mt-2" onclick="navigate('search')">Start Searching</button>
						</div>
					</div>
				</div>
				<!-- GOTO My List -->
				<div class="col-md-4 mb-3">
					<div class="card shadow-sm h-100">
						<div class="card-body text-center">
							<h5 class="card-title">ğŸ“‹ View My List</h5>
							<p class="card-text">See your saved franchises, update them, or remove entries.</p>
							<button class="btn btn-secondary mt-2" onclick="navigate('list')">Go to List</button>
						</div>
					</div>
				</div>
				<div class="col-md-4 offset-md-2 mb-3">
                	<div class="card shadow-sm h-100">
                    	<div class="card-body text-center">
							<h5 class="card-title">ğŸŒ Import from MAL</h5>
							<p class="card-text">Bring in your MyAnimeList franchises and sync them here.</p>
                        	<button class="btn btn-success mt-2" onclick="navigate('malport')">Import From MAL</button>
                    	</div>
                	</div>
            	</div>
				<div class="col-4"></div>
				<div class="col-2"></div>
			</div>
		</div>
	</div>
	
	<!-- Anime Search Page -->
	<div id="search" class="page" style="display:none;">
		<div class="container py-4">
			<!-- Navigation Buttons -->
			<div class="top-0 end-0 my-2 d-flex justify-content-end">
				<button class="btn btn-outline-secondary" onclick="navigate('list');">ğŸ“‹ Go to List</button>
			</div>
			<!-- Search Input -->
			<div class="mb-1 input-group">
				<input id="animeSearchInput" class="form-control" type="text" placeholder="Search anime..." />
				<button class="btn btn-primary" onclick="search_FetchItems()">Search</button>
			</div>
			<p class="text-muted small mb-4 text-center">ğŸ’¡ Tip: For best results, choose <strong>Season 1</strong> or the original entry of a show.</p>
			<!-- Search Results -->
			<div id="SearchCardContainer" class="row"></div>
		</div>
	</div>
	
	<!-- Relations Finder Page -->
	<div id="relations" class="page" style="display:none;">
		<div class="container py-4 position-relative">
			<!-- Navigation Buttons -->
			<div class="position-absolute top-0 end-0 m-3 d-flex flex-column align-items-end" style="z-index: 10;">
				<button class="btn btn-outline-secondary mb-2" onclick="confirmNavigate('search');">â† Go back to search</button>
				<button class="btn btn-outline-secondary" onclick="confirmNavigate('list');">ğŸ“‹ Go to My List</button>
			</div>
			<!-- Info -->
			<div class="d-flex flex-column align-items-center mb-4">
				<img id="loading-img" class="mb-3" src="./images/loading.gif" style="width:160px; height:160px;" alt="Loading..." />
				<h4 id="info-title" class="text-primary fw-semibold mb-2">Loading your franchise...</h4>
				<p class="text-muted text-center mb-3" style="max-width: 400px;">Once loading is complete, click on one of the anime cards below to select a cover image. Then press the button to save your franchise.</p>
				<button id="addAnimeBtn" class="btn btn-lg btn-success px-4" disabled onclick="relations_AddFranchise()">â™¥ï¸ Save Franchise</button>
			</div>
			<!-- Results -->
			<div id="RelationsCardContainer" class="row"></div>
		</div>
	</div>
	
	<!-- My List Page -->
	<div id="list" class="page" style="display:none;">
		<div class="container py-4">
			<!-- Navigation Buttons -->
			<div class="d-flex justify-content-between align-items-center mb-3">
				<div class="d-flex gap-2">
					<button class="btn btn-outline-success" onclick="list_ExportFranchises()">â¬‡ï¸ Export JSON</button>
					<label class="btn btn-outline-warning mb-0">
						â¬†ï¸ Import JSON
						<input type="file" accept=".json" onchange="list_ImportFranchises(event)" hidden />
					</label>
				</div>
				<button class="btn btn-outline-secondary" onclick="navigate('search');">ğŸ” Go to Search</button>
			</div>
			<!-- Ttile & ViewToggle -->
			<div class="d-flex align-items-center gap-2 mb-4">
				<h2 id="toggleViewBtn" class="text-primary fw-bold mb-0" style="cursor: pointer;" onclick="list_ToggleViewMode()">ğŸ–¼</h2>
				<h2 class="text-primary fw-bold mb-0">My Franchises</h2>
			</div>
			<!-- Search Input -->
			<input type="text" class="form-control mb-3" id="franchisesSearchInput" placeholder="ğŸ” Search franchises..." oninput="list_FilterFranchises()" />
			<!-- List -->
			<div id="FranchisesCardContainer"></div>
			<div id="FranchisesListContainer" style="display:none;"></div>
			<!-- GOTO Update Franchises -->
			<div class="d-flex flex-row justify-content-end my-2">
				<button class="btn btn-outline-success" onclick="navigate('recalc')">Update Franchises</button>
			</div>
		</div>
		
	</div>
	
	<!-- Franchise Details Page -->
	<div id="details" class="page" style="display:none;">
		<div class="container py-4">
			<!-- Navigation Button -->
			<button class="btn btn-outline-secondary mb-3" onclick="navigate('list')">â† Back to List</button>
			<!-- Info -->
			<div class="row">
				<!-- Left: Franchise Info -->
				<div class="col-md-4 text-center">
					<div id="details-image-container" class="position-relative d-inline-block">
						<img id="details-image" class="img-fluid rounded shadow mb-3" style="max-height: 300px;" alt="Franchise Cover" />
						<img id="checkmark-image" class="img-fluid m-1 position-absolute" src="./images/unchecked.png"
							style="height:50px; width:50px; cursor:pointer; top:0; left:0" onclick="details_MarkCompleted()" title="Mark as completed" />
						<img id="edit-image" class="img-fluid m-1 position-absolute" src="./images/edit.png"
						style="height:50px; width:50px; cursor:pointer; top:0; right:0;" onclick="details_UpdateImage()" title="Change Image" />
					</div>
					<h3 id="details-name" class="text-primary fw-bold"></h3>
					<p id="details-completion" class="text-muted text-center mb-3">Not Completed</p>
					<div class="d-flex justify-content-center gap-2 mt-2">
						<button class="btn btn-sm btn-outline-primary" onclick="details_EditFranchiseName()">âœï¸ Edit Name</button>
						<button class="btn btn-sm btn-outline-danger" onclick="details_DeleteFranchise()">ğŸ—‘ï¸ Delete Franchise</button>
					</div>
					<p id="total-episodes" class="text-muted text-center mb-3"></p>
					<div id="details-image-selection-info" class="alert alert-info my-4" style="display:none;">
						<p>Click on an anime to set it as the franchise cover image. <br/>
						Click the edit icon again to exit image selection mode.</p>
					</div>
				</div>
				<!-- Right: Anime List -->
				<div class="col-md-8">
					<h5 class="mb-3">ğŸ“º Anime in this Franchise</h5>
					<ul id="details-anime-list" class="list-group"></ul>
				</div>
			</div>
		</div>
	</div>
	
	<!-- Update Franchises Page -->
	<div id="recalc" class="page" style="display:none;">
		<div class="container py-4 position-relative">
			<!-- Navigation Buttons -->
			<div class="position-absolute top-0 end-0 m-3 d-flex flex-column align-items-end" style="z-index: 10;">
				<button class="btn btn-outline-secondary" onclick="confirmNavigate('list');">ğŸ“‹ Go to My List</button>
			</div>
			<!-- Info -->
			<div class="d-flex flex-column align-items-center mb-4">
				<img id="recalc-loading-img" src="./images/loading.gif" class="mb-3" style="width:160px; height:160px;" alt="Loading..." />
				<h4 id="recalc-info-title" class="text-primary fw-semibold mb-2">Loading ...</h4>
				<p class="text-muted text-center mb-3" style="max-width: 400px;">
					As anime titles load, missing entries will appear in the left and edited entires will appear on the right. Clicking the button will apply these changes to your list. This might take a while depending on how many franchises you have saved.
				</p>
				<button id="recalc-addAnimeBtn" class="btn btn-lg btn-success px-4" disabled onclick="recalc_UpdateFranchises()">â™¥ï¸ Update Franchises</button>
			</div>
			<!-- Results -->
				<!-- Status -->
				<div id="recalc-status" class="text-muted mb-3 text-center fs-5"></div>
				<!-- Changes -->
				<div class="row">
					<!-- Left: Missing Anime -->
					<div class="col-lg-7 mb-4">
						<h3 class="text-secondary fw-bold mb-3">ğŸ†• New Titles in Franchises</h3>
						<div id="RecalcCardContainer" class="row"></div>
					</div>

					<!-- Right: Changelog -->
					<div class="col-lg-5">
						<h3 class="text-secondary fw-bold mb-3">ğŸ“‹ Changes & Updates</h3>
						<div id="recalc-changelog" class="border rounded p-3 bg-light"></div>
					</div>
				</div>
		</div>
	</div>

	<!-- MAL Import Page -->
	<div id="malport" class="page" style="display:none;">
		<div class="container py-4 position-relative">
			<!-- Navigation Buttons -->
			<div class="position-absolute top-0 end-0 m-3 d-flex flex-column align-items-end" style="z-index: 10;">
				<button class="btn btn-outline-secondary" onclick="confirmNavigate('list');">ğŸ“‹ Go to My List</button>
			</div>
			<!-- Info -->
			<div id="malport-info">
				<div id="malport-start" style="display:block" class="align-items-center">
					<div class="d-flex flex-column align-items-center mb-4">
						<h2 class="text-primary fw-semibold mb-2">ğŸŒ Import from MyAnimeList</h2>
						<p class="text-muted text-center mb-3" style="max-width: 400px;">
							Upload your exported MAL XML file to sync franchises into your watchlist. To get the xml file, go to Go to <code>https://myanimelist.net/animelist/&lt;UserName&gt;</code> and click the <em>Export</em> button on the side.
						</p>
						<div style="max-width: 400px;">
							<label for="malFile" class="form-label mx-2">Choose MAL XML file</label>
							<input class="form-control" type="file" id="malFile" accept=".xml">
							<button type="button" class="btn btn-success w-100" onclick="malport_Start()">Import Franchises</button>
						</div>
					</div>
				</div>
				<div id="malport-loading" style="display:none" class="align-items-center">
					<div class="d-flex flex-column align-items-center mb-4">
						<img id="malport-loading-img" src="./images/loading.gif" class="mb-3" style="width:160px; height:160px;" alt="Loading..." />
						<p id="malport-info-title" class="text-muted text-center mb-3" style="max-width: 400px;">Loading Anime...</p>
						<button id="malport-addAnimeBtn" class="btn btn-lg btn-success px-4" disabled onclick="malport_AddFranchises()">â™¥ï¸ Add Franchises</button>
					</div>
				</div>
			</div>
			<!-- Results -->
			<div id="MalportListContainer" class="row"></div>
		</div>
	</div>
</body>
</html>

